\PassOptionsToPackage{unicode, pdfusetitle, colorlinks, linkcolor=TUgreen, urlcolor=TUorange}{hyperref}
\documentclass[9pt]{beamer}

\usetheme{TUDo}
\usefonttheme{professionalfonts}

\usepackage[main=ngerman,english,french]{babel}
\usepackage[backend=biber,sorting=nyt,sortlocale=de_DE.UTF-8]{biblatex}

\usepackage{fontspec}

\setmainfont[
  SmallCapsFont = {Latin Modern Roman Caps},
  SlantedFont = {Latin Modern Roman Slanted},
  ItalicFeatures  = {
    SmallCapsFont = {LMRomanCaps10-Oblique}
  },
  ]{Latin Modern Roman}

\setsansfont{Latin Modern Sans}

\setmonofont[
  SmallCapsFont = {Latin Modern Mono Caps},
  SlantedFont = {Latin Modern Mono Slanted},
  ItalicFeatures  = {
    SmallCapsFont = {LMMonoCaps10-Oblique}
  },
  ]{Latin Modern Mono}

\setlength{\parindent}{0pt}
\usepackage[german=quotes,autostyle]{csquotes}
\usepackage{eurosym}

\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{xfrac}
\usepackage[noss]{hepnicenames} % loads bm, before unicode-math
\usepackage[
  math-style=ISO,
  bold-style=ISO,
  sans-style=italic,
  nabla=upright,
  partial=upright,
  vargreek-shape=unicode,
]{unicode-math}
\usepackage[retainorgcmds]{IEEEtrantools}

\setmathfont{Latin Modern Math}

\setmathfont[range={\mathscr,\mathbfscr}]{XITS Math}
%\setmathfont[range={\mathcal,\mathbfcal},StylisticSet=1]{XITS Math}
\setmathfont[range={\mathcal,\mathbfcal}]{Latin Modern Math}

% much nicer than latin Modern or XITS
\DeclareSymbolFont{AMSb}{U}{msb}{m}{n}
\protected\def\mathbb#1{{\mathchar\numexpr256*\symAMSb+`#1\relax}}

% define fallbacks here
\setmathfont[range=\vDash]{XITS Math}
\setmathfont[range=\coloneq]{XITS Math}
\setmathfont[range=\propto]{XITS Math}
\setmathfont[range={\lblkbrbrak,\rblkbrbrak}]{XITS Math}

% make bar horizontal, use \hslash for slashed h
\let\hbar\relax
\DeclareMathSymbol{\hbar}{\mathord}{AMSb}{"7E}
\DeclareMathSymbol{‚Ñè}{\mathord}{AMSb}{"7E}

\usepackage[locale=DE, separate-uncertainty=true, per-mode=fraction]{siunitx}
\AtBeginDocument{\sisetup{math-rm=\mathrm, text-rm=\rmfamily}}

\usepackage[version=3]{mhchem}

\usepackage{booktabs}
\usepackage{tabulary}
\usepackage{threeparttable}
\usepackage{tabu}

\usepackage[]{graphicx}
%\usepackage[labelfont=bf]{caption}
\setbeamertemplate{caption}[numbered]

\usepackage{xcolor}
\usepackage{enumerate}
\usepackage{metalogo}
\usepackage{pdflscape}

\usepackage{fancyvrb}
\usepackage{listings}
\usepackage{lstautogobble}

\lstnewenvironment{lstverbatim}[1][]{
  \lstset
  {
    autogobble,
    language={[LaTeX]TeX},
    basicstyle=\ttfamily,
    texcsstyle=*\color{TUdarkgreen},
    keywordstyle=\color{TUorange},
    commentstyle=\color{blue},
    morekeywords = {hallo},
    otherkeywords={$,$, &, \{, \}, \[, \],  ^, _},
    moretexcs={setmainlanguage, text, num, SI, si, kilo, gram, befehl, subject, titlehead, publishers,
               metre, per, second, squared, micro, subtitle, maketitle, tableofcontents,
               subsection, subsubsection, part, chapter, paragraph, subparagraph,
               iint, iiint, includegraphics, addbibresource, printbibliography,
               OverfullCenter, ExplSyntaxOn, ExplSyntaxOff, NewDocumentCommand,
               enquote, selectlanguage, textcquote,
               setmainfont, setsansfont, setmonofont,
               setmathfont, mathscr, mathbfscr, mathcal, mathbfcal, DeclareSymbolFont, protected, mathbb, numexpr, symAMSb, vDash, coloneq, lblkbrbrak, rblkbrbrak, DeclareMathSymbol,
               omicron, varkappa, Alpha, Beta, Epsilon, Zeta, Eta, Iota, Kappa, Mu, Nu, Omicron, Rho, Tau, Chi, beth, gimel, eth,
               square, increment,
             },
    columns=fullflexible,
    breaklines=true,
    keepspaces=true,
    aboveskip=-0.2em,
    belowskip=-0.2em
  }
}{}

\usepackage{tikz}
\usetikzlibrary{
  arrows,
    arrows.meta,
  positioning,
  shadows,
  shapes
}

\tikzstyle{buttonstyle} = [align=center, rectangle, fill = black!10, draw = black!80, drop shadow, font={\bfseries}, text=TUgreen]

\newcommand{\button}[1]{\tikz[baseline={([yshift=-.8ex]current bounding box.center)}]{\node[buttonstyle] {#1};}}

\newcommand{\doc}[2]{\button{\href{#1}{Doku: #2}}}

\newcommand{\headlineframe}[1]{  % used to show headline at beginning of each logical section
    \begin{frame}
        \begin{center}
            \Huge\color{TUgreen}#1
        \end{center}
    \end{frame}
}

%patch maybe for hepnames
\RenewDocumentCommand \maybebm {m}
{
  \ensuremath{{{#1}}}
}
\RenewDocumentCommand \maybesf {m}
{
  \ensuremath{{#1}}
}
\RenewDocumentCommand \mayberm {m}
{
  \ensuremath{{\mathrm{#1}}}
}
\RenewDocumentCommand \maybeitrm {m}
{
  \ensuremath{{\mathrm{#1}}}
}
\RenewDocumentCommand \maybeitsubscript {m}
{
  \ensuremath{{#1}}
}

\NewDocumentCommand\setN{}{\mathbb{N}}
\NewDocumentCommand\setC{}{\mathbb{C}}
\NewDocumentCommand\grad{}{\operatorname{grad}}
\AtBeginDocument
{
  \RenewDocumentCommand\div{}{\operatorname{div}}
}
\RenewDocumentCommand\v{m}{\mathbf{#1}}
\NewDocumentCommand\til{m}{\ensuremath{\tilde{#1}}}
\NewDocumentEnvironment{eqns}{O{rCl}}
{
  \begin{IEEEeqnarray}{#1}
}
{
  \end{IEEEeqnarray}
  \ignorespacesafterend
}
\NewDocumentEnvironment{eqn}{}  
{
  \begin{eqns}[c]
}
{
  \end{eqns}
  \ignorespacesafterend
}

\ExplSyntaxOn

\NewDocumentCommand \OverfullCenter {+m}
{
	\noindent
	\makebox[\linewidth]{#1}
}

\ExplSyntaxOff

\setbeamertemplate{bibliography item}[text]

% remove space before eqn in block
\addtobeamertemplate{block begin}{\setlength\abovedisplayskip{-5pt}}

\author{PeP et al.\ Toolbox}
\date{2014}
\institute[Pep et al.\ e.V.]{\includegraphics[height=0.5cm]{logos/pep.pdf}}
